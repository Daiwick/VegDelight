<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VegDelight -Checkout</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: linear-gradient(to bottom right, #dcfce7, #bbf7d0); min-height:100vh; }
        nav { background:white; box-shadow:0 1px 3px rgba(0,0,0,0.1); padding:1rem; }
        .nav-container { max-width:80rem; margin:0 auto; display:flex; align-items:center; justify-content:space-between; }
        .logo-section { display:flex; align-items:center; gap:0.75rem; }
        .logo-icon { background:#16a34a; padding:0.5rem; border-radius:0.5rem; }
        .logo-icon svg { width:1.5rem; height:1.5rem; color:white; }
        .logo-text h1 { font-size:1.25rem; font-weight:bold; color:#1f2937; }
        main { max-width:80rem; margin:0 auto; padding:2rem 1rem; }
        .back-btn { display:flex; align-items:center; gap:0.5rem; color:#4b5563; text-decoration:none; font-weight:500; margin-bottom:1.5rem; background:transparent; border:none; cursor:pointer; font-size:1rem; }
        .back-btn:hover { color:#1f2937; }
        .container { display:grid; grid-template-columns:1fr 1fr; gap:2rem; }
        .form-section h2, .summary-section h2 { font-size:1.5rem; font-weight:bold; color:#1f2937; margin-bottom:1.5rem; }
        .form-group { margin-bottom:1rem; }
        label { display:block; font-size:0.875rem; font-weight:500; color:#374151; margin-bottom:0.5rem; }
        input, textarea { width:100%; padding:0.75rem; border:1px solid #d1d5db; border-radius:0.5rem; font-size:1rem; transition:all 0.2s; }
        input:focus, textarea:focus { outline:none; border-color:#16a34a; box-shadow:0 0 0 3px rgba(22,163,74,0.1); }
        textarea { resize:vertical; min-height:100px; }
        .submit-btn { width:100%; background:#16a34a; color:white; padding:1rem; border-radius:0.5rem; font-weight:600; border:none; cursor:pointer; font-size:1rem; margin-top:1.5rem; transition:background 0.2s; }
        .submit-btn:hover { background:#15803d; }
        .summary-box { background:#f9fafb; border-radius:0.75rem; padding:1.5rem; }
        .summary-item { display:flex; justify-content:space-between; margin-bottom:1rem; padding-bottom:1rem; border-bottom:1px solid #e5e7eb; }
        .item-name { font-weight:500; color:#1f2937; }
        .item-qty { font-size:0.875rem; color:#6b7280; }
        .item-total { font-weight:600; color:#1f2937; }
        .summary-total { display:flex; justify-content:space-between; align-items:center; padding-top:1rem; margin-top:1rem; border-top:2px solid #16a34a; }
        .total-label { font-size:1.125rem; font-weight:600; color:#4b5563; }
        .total-amount { font-size:2rem; font-weight:bold; color:#16a34a; }
        .success-message { background:white; border-radius:1rem; padding:3rem; text-align:center; display:none; }
        .success-message.show { display:block; }
        .success-icon { font-size:4rem; margin-bottom:1rem; }
        .order-id-display { font-family:monospace; font-size:0.875rem; color:#6b7280; margin-bottom:2rem; }
        .form-container { display:block; }
        .form-container.hide { display:none; }
        @media (max-width:768px) { .container { grid-template-columns:1fr; } }
    </style>
</head>
<body onload="initCheckout()">

    <nav>
        <div class="nav-container">
            <div class="logo-section">
                <div class="logo-icon">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                </svg>
                </div>
                <div class="logo-text"><h1>VegDelight</h1></div>
            </div>
        </div>
    </nav>

    <main>
        <button class="back-btn" onclick="goBack()">← Back to Cart</button>

        <div class="form-container" id="formContainer">
            <div class="container">
                <div class="form-section">
                    <h2>Delivery Details</h2>
                    <form onsubmit="handleCheckout(event)">
                        <div class="form-group">
                            <label for="customerName">Full Name</label>
                            <input type="text" id="customerName" required>
                        </div>

                        <div class="form-group">
                            <label for="customerEmail">Email</label>
                            <input type="email" id="customerEmail" required>
                        </div>

                        <div class="form-group">
                            <label for="phoneNumber">Phone Number</label>
                            <input type="tel" id="phoneNumber" required>
                        </div>

                        <div class="form-group">
                            <label for="deliveryAddress">Delivery Address</label>
                            <textarea id="deliveryAddress" required></textarea>
                        </div>

                        <button type="submit" class="submit-btn">Place Order</button>
                    </form>
                </div>

                <div class="summary-section">
                    <h2>Order Summary</h2>
                    <div class="summary-box">
                        <div id="summaryItems"></div>
                        <div class="summary-total">
                            <span class="total-label">Total Amount</span>
                            <span class="total-amount" id="totalAmount">₹0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="success-message" id="successMessage">
            <div class="success-icon">✅</div>
            <h2>Order Placed Successfully!</h2>
            <p>Thank you for your order</p>
            <div class="order-id-display">Order ID: <span id="orderId"></span></div>
            <p>Your delicious food is being prepared and will be delivered soon.</p>
            <button class="submit-btn" onclick="goToMenu()">Back to Menu</button>
        </div>
    </main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyBXsEzzDtXO3nuNaCnqerAGEzrZqFVbB4U",
  authDomain: "dvegdelight.firebaseapp.com",
  projectId: "dvegdelight",
  storageBucket: "dvegdelight.firebasestorage.app",
  messagingSenderId: "184865686236",
  appId: "1:184865686236:web:560c5b038cb1584e9caa19"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* Cart */
let cart = [];

/* Init */
window.initCheckout = function () {
  const email = localStorage.getItem("userEmail");
  if (!email) {
    location.href = "login.html";
    return;
  }

  const savedCart = localStorage.getItem("cart");
  if (!savedCart) {
    alert("Your cart is empty");
    location.href = "customer.html";
    return;
  }

  cart = JSON.parse(savedCart);
  if (!cart.length) {
    alert("Your cart is empty");
    location.href = "customer.html";
    return;
  }

  document.getElementById("customerEmail").value = email;
  renderSummary();
};

/* Render Summary */
function renderSummary() {
  const list = document.getElementById("summaryItems");
  list.innerHTML = "";

  let total = 0;

  cart.forEach(item => {
    const itemTotal = item.price * item.qty;
    total += itemTotal;

    list.innerHTML += `
      <div class="summary-item">
        <div>
          <div class="item-name">${item.name}</div>
          <div class="item-qty">Qty: ${item.qty}</div>
        </div>
        <div class="item-total">₹${itemTotal.toFixed(2)}</div>
      </div>
    `;
  });

  document.getElementById("totalAmount").textContent =
    "₹" + total.toFixed(2);
}

/* Place Order */
window.handleCheckout = async function (e) {
  e.preventDefault();

  const order = {
    status: "pending",
    created_at: serverTimestamp(),
    customer_name: customerName.value,
    customer_email: customerEmail.value,
    phone_number: phoneNumber.value,
    delivery_address: deliveryAddress.value,
    total_amount: cart.reduce((s, i) => s + i.price * i.q, 0),
    currency: "INR",
    order_items: cart.map(i => ({
      name: i.name,
      price: i.price,
      quantity: i.qty
    }))
  };

  const ref = await addDoc(collection(db, "orders"), order);

  localStorage.removeItem("cart");

  document.getElementById("orderId").textContent = ref.id;
  document.getElementById("formContainer").classList.add("hide");
  document.getElementById("successMessage").classList.add("show");
};

/* Nav */
window.goBack = () => location.href = "customer.html";
window.goToMenu = () => location.href = "customer.html";
</script>




</body>
</html>
