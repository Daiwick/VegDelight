<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VegDelight ‚Äì Menu Editor</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto;}
body{min-height:100vh;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);padding:40px;color:#1f2937;}
h1{text-align:center;font-size:2.2rem;margin-bottom:30px;}
h2{margin:40px 0 16px;}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:20px;
}
.card{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
}
.card img{
  width:100%;
  height:160px;
  object-fit:cover;
  border-radius:12px;
  margin-bottom:12px;
}
input,textarea{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border:1px solid #e5e7eb;
  border-radius:10px;
}
textarea{resize:vertical;}
.row{display:flex;gap:10px;}
button{
  border:none;
  padding:10px 14px;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
}
.add-btn{background:#16a34a;color:#fff;}
.delete-btn{background:#dc2626;color:#fff;margin-top:6px;}
.note{font-size:.85rem;color:#16a34a;text-align:right;margin-top:4px;}
</style>
</head>

<body>

<h1>üçΩ VegDelight Menu Editor</h1>

<div class="grid" id="items"></div>

<h2>Add New Item</h2>
<div class="card">
  <input id="n_name" placeholder="Item name">
  <div class="row">
    <input id="n_price" type="number" placeholder="Price">
    <input id="n_cat" placeholder="Category">
  </div>
  <textarea id="n_desc" placeholder="Description"></textarea>
  <input id="n_img" placeholder="Image URL">
  <button class="add-btn" onclick="addItem()">Add Item</button>
  <div class="note">Saved instantly to customer page</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* üî• SAME FIREBASE AS customer.html */
const firebaseConfig = {
  apiKey: "AIzaSyBAfAOtcgECePqbIwgKJ0Uc9tsV3w96vZs",
  authDomain: "editor-7f117.firebaseapp.com",
  projectId: "editor-7f117"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let foodItems = [];

/* LOAD ITEMS */
async function loadItems(){
  const snap = await getDocs(collection(db,"foodItems"));
  foodItems = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  render();
}

/* RENDER */
function render(){
  const box = document.getElementById("items");
  box.innerHTML = "";
  if(!foodItems.length){
    box.innerHTML = "<p>No items yet</p>";
    return;
  }

  foodItems.forEach(item=>{
    box.innerHTML += `
      <div class="card">
        <img src="${item.img || ''}">
        <input value="${item.name}" onchange="updateItem('${item.id}','name',this.value)">
        <div class="row">
          <input type="number" value="${item.price}" onchange="updateItem('${item.id}','price',this.value)">
          <input value="${item.cat || ''}" onchange="updateItem('${item.id}','cat',this.value)">
        </div>
        <textarea onchange="updateItem('${item.id}','desc',this.value)">${item.desc || ''}</textarea>
        <input value="${item.img || ''}" onchange="updateItem('${item.id}','img',this.value)">
        <button class="delete-btn" onclick="deleteItem('${item.id}')">Delete</button>
      </div>
    `;
  });
}

/* UPDATE */
window.updateItem = async function(id,key,value){
  const item = foodItems.find(i=>i.id===id);
  if(!item) return;
  item[key] = key==="price" ? Number(value) : value;
  await setDoc(doc(db,"foodItems",id), item);
};

/* ADD */
window.addItem = async function(){
  if(!n_name.value || !n_price.value){
    alert("Name & price required");
    return;
  }

  const id = Date.now().toString();
  const item = {
    name:n_name.value,
    price:Number(n_price.value),
    cat:n_cat.value,
    desc:n_desc.value,
    img:n_img.value
  };

  await setDoc(doc(db,"foodItems",id), item);

  n_name.value=n_price.value=n_cat.value=n_desc.value=n_img.value="";
  loadItems();
};

/* DELETE */
window.deleteItem = async function(id){
  if(!confirm("Delete this item?")) return;
  await deleteDoc(doc(db,"foodItems",id));
  loadItems();
};

loadItems();
</script>

</body>
</html>
